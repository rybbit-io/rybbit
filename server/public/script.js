!function(){const e=document.currentScript,t=e.getAttribute("src").split("/script.js")[0];new Promise(((e,t)=>{const r=document.createElement("script");r.src="https://unpkg.com/web-vitals@3/dist/web-vitals.iife.js",r.onload=()=>e(),r.onerror=()=>t(new Error("Failed to load web-vitals library")),document.head.appendChild(r)})).then((()=>{_()})).catch((e=>{console.warn("Failed to load web vitals library:",e)}));const r="true"===e.getAttribute("data-enable-replay");if(console.log(`[REPLAY] Session replay enabled: ${r}`),r&&(console.log("[REPLAY] Loading rrweb library..."),new Promise(((e,t)=>{const r=document.createElement("script");r.src="https://cdn.jsdelivr.net/npm/rrweb@2.0.0-alpha.18/dist/rrweb.min.js",r.onload=()=>e(),r.onerror=()=>t(new Error("Failed to load rrweb library")),document.head.appendChild(r)})).then((()=>{console.log("[REPLAY] rrweb library loaded successfully"),N()})).catch((e=>{console.error("[REPLAY ERROR] Failed to load rrweb library:",e)}))),null!==localStorage.getItem("disable-rybbit"))return void(window.rybbit={pageview:()=>{},event:()=>{},trackOutbound:()=>{},identify:()=>{},clearUserId:()=>{},getUserId:()=>null});if(!t)return void console.error("Please provide a valid analytics host");const n=e.getAttribute("data-site-id")||e.getAttribute("site-id");if(!n||isNaN(Number(n)))return void console.error("Please provide a valid site ID using the data-site-id attribute");const o=Number(n);console.log(`[REPLAY] Site ID converted from string "${n}" to number ${o}`);const a=e.getAttribute("data-debounce")?Math.max(0,parseInt(e.getAttribute("data-debounce"))):500,s="false"!==e.getAttribute("data-auto-track-pageview"),l="false"!==e.getAttribute("data-track-spa"),i="false"!==e.getAttribute("data-track-query"),c="false"!==e.getAttribute("data-track-outbound"),d=parseFloat(e.getAttribute("data-replay-sample-rate")||"1.0"),u=parseInt(e.getAttribute("data-replay-max-duration")||"300000"),p="false"!==e.getAttribute("data-replay-mask-inputs"),g=e.getAttribute("data-replay-mask-selectors")||"input[type='password'], input[type='email'], .sensitive, [data-sensitive]";console.log("[REPLAY] Configuration:",{sampleRate:d,maxDuration:u,maskInputs:p,maskSelectors:g});let b=[];try{const t=e.getAttribute("data-skip-patterns");t&&(b=JSON.parse(t),Array.isArray(b)||(b=[]))}catch(e){console.error("Error parsing data-skip-patterns:",e)}let m=[];try{const t=e.getAttribute("data-mask-patterns");t&&(m=JSON.parse(t),Array.isArray(m)||(m=[]))}catch(e){console.error("Error parsing data-mask-patterns:",e)}let y=null;try{const e=localStorage.getItem("rybbit-user-id");e&&(y=e)}catch(e){}let h=null,f=[],w=null,R=null,A=null;function v(e){const t="__DOUBLE_ASTERISK_TOKEN__",r="__SINGLE_ASTERISK_TOKEN__";let n=e.replace(/\*\*/g,t).replace(/\*/g,r).replace(/[.+?^${}()|[\]\\]/g,"\\$&");n=n.replace(/\//g,"\\/");let o=n.replace(new RegExp(t,"g"),".*").replace(new RegExp(r,"g"),"[^/]+");return new RegExp("^"+o+"$")}function E(e,t){for(const r of t)try{if(v(r).test(e))return r}catch(e){console.error(`Invalid pattern: ${r}`,e)}return null}const P=()=>{const e=new URL(window.location.href);let t=e.pathname;if(e.hash&&e.hash.startsWith("#/")&&(t=e.hash.substring(1)),E(t,b))return null;const r=E(t,m);r&&(t=r);const n={site_id:o,hostname:e.hostname,pathname:t,querystring:i?e.search:"",screenWidth:window.innerWidth,screenHeight:window.innerHeight,language:navigator.language,page_title:document.title,referrer:document.referrer};return y&&(n.user_id=y),n},L=e=>{fetch(`${t}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors",keepalive:!0}).catch(console.error)},S=(e="pageview",t="",r={})=>{if("custom_event"===e&&(!t||"string"!=typeof t))return void console.error("Event name is required and must be a string for custom events");const n=P();if(!n)return;const o={...n,type:e,event_name:t,properties:"custom_event"===e||"outbound"===e?JSON.stringify(r):void 0};L(o)};let I={lcp:null,cls:null,inp:null,fcp:null,ttfb:null},Y=!1,$=null;const x=()=>{if(Y)return;Y=!0,$&&(clearTimeout($),$=null);const e=P();if(!e)return;const t={...e,type:"performance",event_name:"web-vitals",lcp:I.lcp,cls:I.cls,inp:I.inp,fcp:I.fcp,ttfb:I.ttfb};L(t)},k=e=>{Y||(I[e.name.toLowerCase()]=e.value,(()=>{if(Y)return;Object.values(I).every((e=>null!==e))&&x()})())},_=()=>{if("undefined"!=typeof webVitals)try{webVitals.getLCP(k),webVitals.getCLS(k),webVitals.getINP(k),webVitals.getFCP(k),webVitals.getTTFB(k),$=setTimeout((()=>{Y||x()}),2e4),window.addEventListener("beforeunload",(()=>{Y||x()}))}catch(e){console.warn("Error initializing web vitals tracking:",e)}},T=(e,r=!1)=>{if(!e.length)return void console.log("[REPLAY] sendReplayEvents called with empty events array");const n={site_id:o,session_id:w,events:e,is_complete:r,timestamp:(new Date).toISOString()};y&&(n.user_id=y);const a=JSON.stringify(n).length;console.log(`[REPLAY] Sending ${e.length} events (${a} bytes) to ${t}/replay/ingest, isComplete: ${r}`),fetch(`${t}/replay/ingest`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),mode:"cors",keepalive:!0}).then((t=>{t.ok?console.log(`[REPLAY] Successfully sent ${e.length} events`):console.error(`[REPLAY ERROR] Failed to send events - Status: ${t.status} ${t.statusText}`)})).catch((e=>{console.error("[REPLAY ERROR] Network error sending events:",e)}))},O=()=>{console.log("[REPLAY] Stopping replay recording"),h&&(console.log("[REPLAY] Calling rrweb recorder stop function"),h(),h=null),f.length>0&&(console.log(`[REPLAY] Sending final ${f.length} events before stopping`),T(f,!0),f=[]),A&&(clearTimeout(A),A=null,console.log("[REPLAY] Cleared batch timeout")),console.log("[REPLAY] Replay recording stopped")},N=()=>{if(console.log("[REPLAY] initSessionReplay() called"),"undefined"!=typeof rrweb)if((()=>{const e=Math.random(),t=e<d;return console.log(`[REPLAY] shouldStartReplay() called - random: ${e.toFixed(4)}, sampleRate: ${d}, result: ${t}`),t})())try{w=crypto.randomUUID?crypto.randomUUID():"xxxx-xxxx-4xxx-yxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),R=Date.now(),console.log(`[REPLAY] Generated session ID: ${w}, start time: ${new Date(R).toISOString()}`);const e=g.split(",").map((e=>e.trim())).filter(Boolean);console.log("[REPLAY] Parsed mask selectors:",e);const t={emit(e){console.log(`[REPLAY] Event emitted - type: ${e.type}, timestamp: ${e.timestamp}`),f.push(e),(()=>{if(f.length>=50){const e=f.splice(0,50);console.log(`[REPLAY] Batching ${e.length} events (batch size reached)`),T(e)}A&&clearTimeout(A),A=setTimeout((()=>{if(f.length>0){const e=f.splice(0);console.log(`[REPLAY] Batching ${e.length} events (timeout reached)`),T(e)}}),5e3)})()},maskAllInputs:p,maskTextSelector:e.join(","),maskInputSelector:p?"input":"",blockSelector:".rybbit-no-record, [data-rybbit-no-record]",sampling:{mousemove:!0,mouseInteraction:!0,scroll:150,input:"last"},recordCanvas:!1,collectFonts:!1};console.log("[REPLAY] Starting rrweb.record() with options:",t),h=rrweb.record(t),console.log("[REPLAY] rrweb recording started successfully"),setTimeout((()=>{console.log(`[REPLAY] Max duration (${u}ms) reached, stopping replay`),O()}),u),window.addEventListener("beforeunload",(()=>{console.log("[REPLAY] Page unloading, stopping replay"),O()})),window.addEventListener("pagehide",(()=>{console.log("[REPLAY] Page hiding, stopping replay"),O()}))}catch(e){console.error("[REPLAY ERROR] Error initializing session replay:",e)}else console.log("[REPLAY] Replay not started due to sample rate");else console.warn("[REPLAY WARNING] rrweb library not available")},C=()=>S("pageview"),D=a>0?function(e,t){let r;return(...n)=>{clearTimeout(r),r=setTimeout((()=>e.apply(this,n)),t)}}(C,a):C;if(c&&document.addEventListener("click",(function(e){const t=e.target.closest("a");t&&t.href&&function(e){try{const t=window.location.hostname,r=new URL(e).hostname;return r!==t&&""!==r}catch(e){return!1}}(t.href)&&S("outbound","",{url:t.href,text:t.innerText||t.textContent||"",target:t.target||"_self"})})),l){const e=history.pushState,t=history.replaceState;history.pushState=function(...t){e.apply(this,t),D()},history.replaceState=function(...e){t.apply(this,e),D()},window.addEventListener("popstate",D),window.addEventListener("hashchange",D)}window.rybbit={pageview:C,event:(e,t={})=>S("custom_event",e,t),trackOutbound:(e,t="",r="_self")=>S("outbound","",{url:e,text:t,target:r}),identify:e=>{if("string"==typeof e&&""!==e.trim()){y=e.trim();try{localStorage.setItem("rybbit-user-id",y)}catch(e){console.warn("Could not persist user ID to localStorage")}}else console.error("User ID must be a non-empty string")},clearUserId:()=>{y=null;try{localStorage.removeItem("rybbit-user-id")}catch(e){}},getUserId:()=>y,startReplay:()=>{console.log(`[REPLAY] Public API startReplay() called - enableSessionReplay: ${r}, rrweb available: ${"undefined"!=typeof rrweb}, recorder active: ${null!==h}`),r&&"undefined"!=typeof rrweb&&!h?N():console.warn("[REPLAY WARNING] Cannot start replay - conditions not met")},stopReplay:()=>{console.log("[REPLAY] Public API stopReplay() called"),O()},isReplayActive:()=>{const e=null!==h;return console.log(`[REPLAY] Public API isReplayActive() called - result: ${e}`),e},getReplaySessionId:()=>(console.log(`[REPLAY] Public API getReplaySessionId() called - result: ${w}`),w)},s&&C()}();