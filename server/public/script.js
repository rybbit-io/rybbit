"use strict";(()=>{var it=Object.defineProperty;var at=(r,t,e)=>t in r?it(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var h=(r,t,e)=>at(r,typeof t!="symbol"?t+"":t,e);function st(r){let t="__DOUBLE_ASTERISK_TOKEN__",e="__SINGLE_ASTERISK_TOKEN__",i=r.replace(/\*\*/g,t).replace(/\*/g,e).replace(/[.+?^${}()|[\]\\]/g,"\\$&");i=i.replace(new RegExp(`/${t}/`,"g"),"/(?:.+/)?"),i=i.replace(new RegExp(t,"g"),".*"),i=i.replace(/\//g,"\\/");let c=i.replace(new RegExp(e,"g"),"[^/]+");return new RegExp("^"+c+"$")}function E(r,t){for(let e of t)try{if(st(e).test(r))return e}catch(n){console.error(`Invalid pattern: ${e}`,n)}return null}function N(r,t){let e=null;return(...n)=>{e&&clearTimeout(e),e=setTimeout(()=>r(...n),t)}}function W(r){try{let t=window.location.hostname,e=new URL(r).hostname;return e!==t&&e!==""}catch{return!1}}function P(r,t){if(!r)return t;try{let e=JSON.parse(r);return Array.isArray(t)&&!Array.isArray(e)?t:e}catch(e){return console.error("Error parsing JSON:",e),t}}function B(r){let t=r.getAttribute("src");if(!t)return console.error("Script src attribute is missing"),null;let e=t.split("/script.js")[0];if(!e)return console.error("Please provide a valid analytics host"),null;let n=r.getAttribute("data-site-id")||r.getAttribute("site-id");if(!n||isNaN(Number(n)))return console.error("Please provide a valid site ID using the data-site-id attribute"),null;let i=r.getAttribute("data-debounce")?Math.max(0,parseInt(r.getAttribute("data-debounce"))):500,c=P(r.getAttribute("data-skip-patterns"),[]),a=P(r.getAttribute("data-mask-patterns"),[]),s=r.getAttribute("data-api-key")||void 0;return{analyticsHost:e,siteId:n,debounceDuration:i,autoTrackPageview:r.getAttribute("data-auto-track-pageview")!=="false",autoTrackSpa:r.getAttribute("data-track-spa")!=="false",trackQuerystring:r.getAttribute("data-track-query")!=="false",trackOutbound:r.getAttribute("data-track-outbound")!=="false",enableWebVitals:r.getAttribute("data-web-vitals")==="true",trackErrors:r.getAttribute("data-track-errors")==="true",skipPatterns:c,maskPatterns:a,apiKey:s}}var b=class{constructor(t){this.customUserId=null;this.config=t,this.loadUserId()}loadUserId(){try{let t=localStorage.getItem("rybbit-user-id");t&&(this.customUserId=t)}catch{}}createBasePayload(){let t=new URL(window.location.href),e=t.pathname;if(t.hash&&t.hash.startsWith("#/")&&(e=t.hash.substring(1)),E(e,this.config.skipPatterns))return null;let n=E(e,this.config.maskPatterns);n&&(e=n);let i={site_id:this.config.siteId,hostname:t.hostname,pathname:e,querystring:this.config.trackQuerystring?t.search:"",screenWidth:window.innerWidth,screenHeight:window.innerHeight,language:navigator.language,page_title:document.title,referrer:document.referrer};return this.customUserId&&(i.user_id=this.customUserId),this.config.apiKey&&(i.api_key=this.config.apiKey),i}async sendTrackingData(t){try{await fetch(`${this.config.analyticsHost}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),mode:"cors",keepalive:!0})}catch(e){console.error("Failed to send tracking data:",e)}}track(t,e="",n={}){if(t==="custom_event"&&(!e||typeof e!="string")){console.error("Event name is required and must be a string for custom events");return}let i=this.createBasePayload();if(!i)return;let c={...i,type:t,event_name:e,properties:t==="custom_event"||t==="outbound"||t==="error"?JSON.stringify(n):void 0};this.sendTrackingData(c)}trackPageview(){this.track("pageview")}trackEvent(t,e={}){this.track("custom_event",t,e)}trackOutbound(t,e="",n="_self"){this.track("outbound","",{url:t,text:e,target:n})}trackWebVitals(t){let e=this.createBasePayload();if(!e)return;let n={...e,type:"performance",event_name:"web-vitals",...t};this.sendTrackingData(n)}trackError(t,e={}){let n=window.location.origin,i=e.filename||"",c=t.stack||"";if(i)try{if(new URL(i).origin!==n)return}catch{}else if(c&&!c.includes(n))return;let a={message:t.message?.substring(0,500)||"Unknown error",stack:c.substring(0,2e3)||"",filename:i,lineno:e.lineno||0,colno:e.colno||0,...e};this.track("error",t.name||"Error",a)}identify(t){if(typeof t!="string"||t.trim()===""){console.error("User ID must be a non-empty string");return}this.customUserId=t.trim();try{localStorage.setItem("rybbit-user-id",this.customUserId)}catch{console.warn("Could not persist user ID to localStorage")}}clearUserId(){this.customUserId=null;try{localStorage.removeItem("rybbit-user-id")}catch{}}getUserId(){return this.customUserId}};var G=-1,m=r=>{addEventListener("pageshow",t=>{t.persisted&&(G=t.timeStamp,r(t))},!0)},d=(r,t,e,n)=>{let i,c;return a=>{t.value>=0&&(a||n)&&(c=t.value-(i??0),(c||i===void 0)&&(i=t.value,t.delta=c,t.rating=((s,o)=>s>o[1]?"poor":s>o[0]?"needs-improvement":"good")(t.value,e),r(t)))}},R=r=>{requestAnimationFrame(()=>requestAnimationFrame(()=>r()))},M=()=>{let r=performance.getEntriesByType("navigation")[0];if(r&&r.responseStart>0&&r.responseStart<performance.now())return r},p=()=>M()?.activationStart??0,u=(r,t=-1)=>{let e=M(),n="navigate";return G>=0?n="back-forward-cache":e&&(document.prerendering||p()>0?n="prerender":document.wasDiscarded?n="restore":e.type&&(n=e.type.replace(/_/g,"-"))),{name:r,value:t,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:n}},S=new WeakMap;function U(r,t){return S.get(r)||S.set(r,new t),S.get(r)}var I=class{constructor(){h(this,"t");h(this,"i",0);h(this,"o",[])}h(t){if(t.hadRecentInput)return;let e=this.o[0],n=this.o.at(-1);this.i&&e&&n&&t.startTime-n.startTime<1e3&&t.startTime-e.startTime<5e3?(this.i+=t.value,this.o.push(t)):(this.i=t.value,this.o=[t]),this.t?.(t)}},f=(r,t,e={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(r)){let n=new PerformanceObserver(i=>{Promise.resolve().then(()=>{t(i.getEntries())})});return n.observe({type:r,buffered:!0,...e}),n}}catch{}},O=r=>{let t=!1;return()=>{t||(r(),t=!0)}},g=-1,H=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,y=r=>{document.visibilityState==="hidden"&&g>-1&&(g=r.type==="visibilitychange"?r.timeStamp:0,ot())},V=()=>{addEventListener("visibilitychange",y,!0),addEventListener("prerenderingchange",y,!0)},ot=()=>{removeEventListener("visibilitychange",y,!0),removeEventListener("prerenderingchange",y,!0)},Q=()=>{if(g<0){let r=p();g=(document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter(e=>e.name==="hidden"&&e.startTime>r)[0]?.startTime)??H(),V(),m(()=>{setTimeout(()=>{g=H(),V()})})}return{get firstHiddenTime(){return g}}},T=r=>{document.prerendering?addEventListener("prerenderingchange",()=>r(),!0):r()},F=[1800,3e3],x=(r,t={})=>{T(()=>{let e=Q(),n,i=u("FCP"),c=f("paint",a=>{for(let s of a)s.name==="first-contentful-paint"&&(c.disconnect(),s.startTime<e.firstHiddenTime&&(i.value=Math.max(s.startTime-p(),0),i.entries.push(s),n(!0)))});c&&(n=d(r,i,F,t.reportAllChanges),m(a=>{i=u("FCP"),n=d(r,i,F,t.reportAllChanges),R(()=>{i.value=performance.now()-a.timeStamp,n(!0)})}))})},K=[.1,.25],Y=(r,t={})=>{x(O(()=>{let e,n=u("CLS",0),i=U(t,I),c=s=>{for(let o of s)i.h(o);i.i>n.value&&(n.value=i.i,n.entries=i.o,e())},a=f("layout-shift",c);a&&(e=d(r,n,K,t.reportAllChanges),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(c(a.takeRecords()),e(!0))}),m(()=>{i.i=0,n=u("CLS",0),e=d(r,n,K,t.reportAllChanges),R(()=>e())}),setTimeout(e))}))},X=0,C=1/0,v=0,ct=r=>{for(let t of r)t.interactionId&&(C=Math.min(C,t.interactionId),v=Math.max(v,t.interactionId),X=v?(v-C)/7+1:0)},L,$=()=>L?X:performance.interactionCount??0,lt=()=>{"interactionCount"in performance||L||(L=f("event",ct,{type:"event",buffered:!0,durationThreshold:0}))},J=0,_=class{constructor(){h(this,"u",[]);h(this,"l",new Map);h(this,"m");h(this,"v")}p(){J=$(),this.u.length=0,this.l.clear()}P(){let t=Math.min(this.u.length-1,Math.floor(($()-J)/50));return this.u[t]}h(t){if(this.m?.(t),!t.interactionId&&t.entryType!=="first-input")return;let e=this.u.at(-1),n=this.l.get(t.interactionId);if(n||this.u.length<10||t.duration>e.T){if(n?t.duration>n.T?(n.entries=[t],n.T=t.duration):t.duration===n.T&&t.startTime===n.entries[0].startTime&&n.entries.push(t):(n={id:t.interactionId,entries:[t],T:t.duration},this.l.set(n.id,n),this.u.push(n)),this.u.sort((i,c)=>c.T-i.T),this.u.length>10){let i=this.u.splice(10);for(let c of i)this.l.delete(c.id)}this.v?.(n)}}},Z=r=>{let t=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?r():(r=O(r),document.addEventListener("visibilitychange",r,{once:!0}),t(()=>{r(),document.removeEventListener("visibilitychange",r)}))},j=[200,500],tt=(r,t={})=>{globalThis.PerformanceEventTiming&&"interactionId"in PerformanceEventTiming.prototype&&T(()=>{lt();let e,n=u("INP"),i=U(t,_),c=s=>{Z(()=>{for(let l of s)i.h(l);let o=i.P();o&&o.T!==n.value&&(n.value=o.T,n.entries=o.entries,e())})},a=f("event",c,{durationThreshold:t.durationThreshold??40});e=d(r,n,j,t.reportAllChanges),a&&(a.observe({type:"first-input",buffered:!0}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(c(a.takeRecords()),e(!0))}),m(()=>{i.p(),n=u("INP"),e=d(r,n,j,t.reportAllChanges)}))})},A=class{constructor(){h(this,"m")}h(t){this.m?.(t)}},q=[2500,4e3],et=(r,t={})=>{T(()=>{let e=Q(),n,i=u("LCP"),c=U(t,A),a=o=>{t.reportAllChanges||(o=o.slice(-1));for(let l of o)c.h(l),l.startTime<e.firstHiddenTime&&(i.value=Math.max(l.startTime-p(),0),i.entries=[l],n())},s=f("largest-contentful-paint",a);if(s){n=d(r,i,q,t.reportAllChanges);let o=O(()=>{a(s.takeRecords()),s.disconnect(),n(!0)});for(let l of["keydown","click","visibilitychange"])addEventListener(l,()=>Z(o),{capture:!0,once:!0});m(l=>{i=u("LCP"),n=d(r,i,q,t.reportAllChanges),R(()=>{i.value=performance.now()-l.timeStamp,n(!0)})})}})},z=[800,1800],D=r=>{document.prerendering?T(()=>D(r)):document.readyState!=="complete"?addEventListener("load",()=>D(r),!0):setTimeout(r)},rt=(r,t={})=>{let e=u("TTFB"),n=d(r,e,z,t.reportAllChanges);D(()=>{let i=M();i&&(e.value=Math.max(i.responseStart-p(),0),e.entries=[i],n(!0),m(()=>{e=u("TTFB",0),n=d(r,e,z,t.reportAllChanges),n(!0)}))})};var k=class{constructor(t){this.data={lcp:null,cls:null,inp:null,fcp:null,ttfb:null};this.sent=!1;this.timeout=null;this.onReadyCallback=null;this.onReadyCallback=t}initialize(){try{et(this.collectMetric.bind(this)),Y(this.collectMetric.bind(this)),tt(this.collectMetric.bind(this)),x(this.collectMetric.bind(this)),rt(this.collectMetric.bind(this)),this.timeout=setTimeout(()=>{this.sent||this.sendData()},2e4),window.addEventListener("beforeunload",()=>{this.sent||this.sendData()})}catch(t){console.warn("Error initializing web vitals tracking:",t)}}collectMetric(t){if(this.sent)return;let e=t.name.toLowerCase();this.data[e]=t.value,Object.values(this.data).every(i=>i!==null)&&this.sendData()}sendData(){this.sent||(this.sent=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.onReadyCallback&&this.onReadyCallback(this.data))}getData(){return{...this.data}}};(function(){let r=document.currentScript;if(!r){console.error("Could not find current script tag");return}if(window.__RYBBIT_OPTOUT__||localStorage.getItem("disable-rybbit")!==null){window.rybbit={pageview:()=>{},event:()=>{},trackOutbound:()=>{},identify:()=>{},clearUserId:()=>{},getUserId:()=>null};return}let t=B(r);if(!t)return;let e=new b(t);t.enableWebVitals&&new k(s=>{e.trackWebVitals(s)}).initialize(),t.trackErrors&&(window.addEventListener("error",a=>{e.trackError(a.error||new Error(a.message),{filename:a.filename,lineno:a.lineno,colno:a.colno})}),window.addEventListener("unhandledrejection",a=>{let s=a.reason instanceof Error?a.reason:new Error(String(a.reason));e.trackError(s,{type:"unhandledrejection"})}));let n=()=>e.trackPageview(),i=t.debounceDuration>0?N(n,t.debounceDuration):n;function c(){if(document.addEventListener("click",function(a){let s=a.target;for(;s&&s!==document.documentElement;){if(s.hasAttribute("data-rybbit-event")){let o=s.getAttribute("data-rybbit-event");if(o){let l={};for(let w of s.attributes)if(w.name.startsWith("data-rybbit-prop-")){let nt=w.name.replace("data-rybbit-prop-","");l[nt]=w.value}e.trackEvent(o,l)}break}s=s.parentElement}if(t.trackOutbound){let o=a.target.closest("a");o?.href&&W(o.href)&&e.trackOutbound(o.href,o.innerText||o.textContent||"",o.target||"_self")}}),t.autoTrackSpa){let a=history.pushState,s=history.replaceState;history.pushState=function(...o){a.apply(this,o),i()},history.replaceState=function(...o){s.apply(this,o),i()},window.addEventListener("popstate",i),window.addEventListener("hashchange",i)}}window.rybbit={pageview:()=>e.trackPageview(),event:(a,s={})=>e.trackEvent(a,s),trackOutbound:(a,s="",o="_self")=>e.trackOutbound(a,s,o),identify:a=>e.identify(a),clearUserId:()=>e.clearUserId(),getUserId:()=>e.getUserId()},c(),t.autoTrackPageview&&e.trackPageview()})();})();
