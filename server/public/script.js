!function(){let t=document.currentScript,e=t.getAttribute("src").split("/script.js")[0];if(null!==localStorage.getItem("disable-rybbit")){window.rybbit={pageview(){},event(){},trackOutbound(){},identify(){},clearUserId(){},getUserId:()=>null,setGlobalProperties(){},updateGlobalProperties(){},clearGlobalProperties(){},getGlobalProperties:()=>({})};return}if(!e){console.error("Please provide a valid analytics host");return}let r=t.getAttribute("data-site-id")||t.getAttribute("site-id");if(!r||isNaN(Number(r))){console.error("Please provide a valid site ID using the data-site-id attribute");return}let a=t.getAttribute("data-debounce")?Math.max(0,parseInt(t.getAttribute("data-debounce"))):500,i="false"!==t.getAttribute("data-auto-track-pageview"),n="false"!==t.getAttribute("data-track-spa"),s="false"!==t.getAttribute("data-track-query"),l="false"!==t.getAttribute("data-track-outbound"),o=[];try{let u=t.getAttribute("data-skip-patterns");u&&(o=JSON.parse(u),Array.isArray(o)||(o=[]))}catch(p){console.error("Error parsing data-skip-patterns:",p)}let c=[];try{let b=t.getAttribute("data-mask-patterns");b&&(c=JSON.parse(b),Array.isArray(c)||(c=[]))}catch(g){console.error("Error parsing data-mask-patterns:",g)}let d=null;try{let h=localStorage.getItem("rybbit-user-id");h&&(d=h)}catch(y){}let f={};try{let m=localStorage.getItem("rybbit-global-properties");m&&(f=JSON.parse(m))}catch(v){f={}}function I(t){let e="__DOUBLE_ASTERISK_TOKEN__",r="__SINGLE_ASTERISK_TOKEN__",a=t.replace(/\*\*/g,e).replace(/\*/g,r).replace(/[.+?^${}()|[\]\\]/g,"\\$&"),i=(a=a.replace(/\//g,"\\/")).replace(RegExp(e,"g"),".*").replace(RegExp(r,"g"),"[^/]+");return RegExp("^"+i+"$")}function A(t,e){for(let r of e)try{let a=I(r);if(a.test(t))return r}catch(i){console.error(`Invalid pattern: ${r}`,i)}return null}let k=(t="pageview",a="",i={})=>{if("custom_event"===t&&(!a||"string"!=typeof a)){console.error("Event name is required and must be a string for custom events");return}let n=new URL(window.location.href),l=n.pathname;if(n.hash&&n.hash.startsWith("#/")&&(l=n.hash.substring(1)),A(l,o))return;let u=A(l,c);u&&(l=u);let p=function t(e={}){let r={...f,...e};return Object.keys(r).length>0?r:null}(i),b={site_id:r,hostname:n.hostname,pathname:l,querystring:s?n.search:"",screenWidth:window.innerWidth,screenHeight:window.innerHeight,language:navigator.language,page_title:document.title,referrer:document.referrer,type:t,event_name:a};p&&(b.properties=JSON.stringify(p)),d&&(b.user_id=d),fetch(`${e}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b),mode:"cors",keepalive:!0}).catch(console.error)},S=()=>k("pageview"),E=a>0?function t(e,r){let a;return(...t)=>{clearTimeout(a),a=setTimeout(()=>e.apply(this,t),r)}}(S,a):S;if(l&&document.addEventListener("click",function(t){let e=t.target.closest("a");e&&e.href&&function t(e){try{let r=window.location.hostname,a=new URL(e).hostname;return a!==r&&""!==a}catch(i){return!1}}(e.href)&&k("outbound","",{url:e.href,text:e.innerText||e.textContent||"",target:e.target||"_self"})}),n){let P=history.pushState,w=history.replaceState;history.pushState=function(...t){P.apply(this,t),E()},history.replaceState=function(...t){w.apply(this,t),E()},window.addEventListener("popstate",E),window.addEventListener("hashchange",E)}window.rybbit={pageview:S,event:(t,e={})=>k("custom_event",t,e),trackOutbound:(t,e="",r="_self")=>k("outbound","",{url:t,text:e,target:r}),identify(t){if("string"!=typeof t||""===t.trim()){console.error("User ID must be a non-empty string");return}d=t.trim();try{localStorage.setItem("rybbit-user-id",d)}catch(e){console.warn("Could not persist user ID to localStorage")}},clearUserId(){d=null;try{localStorage.removeItem("rybbit-user-id")}catch(t){}},getUserId:()=>d,setGlobalProperties(t){if("object"!=typeof t||null===t||Array.isArray(t)){console.error("Global properties must be a non-null object");return}f={...t};try{localStorage.setItem("rybbit-global-properties",JSON.stringify(f))}catch(e){console.warn("Could not persist global properties to localStorage")}},updateGlobalProperties(t){if("object"!=typeof t||null===t||Array.isArray(t)){console.error("Properties must be a non-null object");return}f={...f,...t};try{localStorage.setItem("rybbit-global-properties",JSON.stringify(f))}catch(e){console.warn("Could not persist global properties to localStorage")}},clearGlobalProperties(){f={};try{localStorage.removeItem("rybbit-global-properties")}catch(t){}},getGlobalProperties:()=>({...f})},i&&S()}();